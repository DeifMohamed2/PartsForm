<%- include('partials/header') %>
<link rel="stylesheet" href="/css/adminCSS/admin-dashboard.css">
<link rel="stylesheet" href="/css/adminCSS/admin-aog.css">
<style>
  /* Form Styles */
  .form-container {
    width: 100%;
  }
  
  .form-card {
    background: var(--admin-bg-secondary);
    border: 1px solid var(--admin-border);
    border-radius: 16px;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }
  
  .form-card-header {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--admin-border);
    background: var(--admin-bg-tertiary);
  }
  
  .form-card-header h3 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--admin-text-primary);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .form-card-header h3 i {
    width: 18px;
    height: 18px;
    color: #0ea5e9;
  }
  
  .form-card-body {
    padding: 1.5rem;
  }
  
  .form-row {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }
  
  .form-row:last-child {
    margin-bottom: 0;
  }
  
  .form-row.three-cols {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .form-row.single {
    grid-template-columns: 1fr;
  }
  
  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .form-label {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--admin-text-primary);
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }
  
  .form-label .required {
    color: #ef4444;
  }
  
  .form-input,
  .form-select,
  .form-textarea {
    padding: 0.75rem 1rem;
    background: var(--admin-bg-primary);
    border: 1px solid var(--admin-border);
    border-radius: 10px;
    color: var(--admin-text-primary);
    font-size: 0.9rem;
    transition: all 0.2s ease;
  }
  
  .form-input:focus,
  .form-select:focus,
  .form-textarea:focus {
    outline: none;
    border-color: #0ea5e9;
    box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
  }
  
  .form-textarea {
    min-height: 100px;
    resize: vertical;
  }
  
  .form-select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    padding-right: 2.5rem;
  }
  
  .form-hint {
    font-size: 0.75rem;
    color: var(--admin-text-muted);
  }
  
  /* Priority Selection */
  .priority-options {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }
  
  .priority-option {
    position: relative;
  }
  
  .priority-option input {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }
  
  .priority-option label {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.25rem;
    background: var(--admin-bg-primary);
    border: 2px solid var(--admin-border);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .priority-option label:hover {
    border-color: var(--admin-text-muted);
  }
  
  .priority-option input:checked + label {
    border-color: #0ea5e9;
    background: rgba(14, 165, 233, 0.05);
  }
  
  .priority-option.critical input:checked + label {
    border-color: #ef4444;
    background: rgba(239, 68, 68, 0.05);
  }
  
  .priority-option.high input:checked + label {
    border-color: #f59e0b;
    background: rgba(245, 158, 11, 0.05);
  }
  
  .priority-option.medium input:checked + label {
    border-color: #3b82f6;
    background: rgba(59, 130, 246, 0.05);
  }
  
  .priority-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 0.75rem;
  }
  
  .priority-icon i {
    width: 20px;
    height: 20px;
  }
  
  .priority-option.critical .priority-icon {
    background: rgba(239, 68, 68, 0.12);
    color: #ef4444;
  }
  
  .priority-option.high .priority-icon {
    background: rgba(245, 158, 11, 0.12);
    color: #f59e0b;
  }
  
  .priority-option.medium .priority-icon {
    background: rgba(59, 130, 246, 0.12);
    color: #3b82f6;
  }
  
  .priority-name {
    font-weight: 600;
    color: var(--admin-text-primary);
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
  }
  
  .priority-desc {
    font-size: 0.75rem;
    color: var(--admin-text-muted);
    text-align: center;
  }
  
  /* Parts Items */
  .parts-section {
    margin-top: 1rem;
  }
  
  .part-row {
    display: grid;
    grid-template-columns: 2fr 1fr 100px auto;
    gap: 1rem;
    align-items: end;
    padding: 1rem;
    background: var(--admin-bg-tertiary);
    border-radius: 12px;
    margin-bottom: 0.75rem;
  }
  
  .part-row .form-group {
    margin-bottom: 0;
  }
  
  .remove-part-btn {
    width: 40px;
    height: 40px;
    border: none;
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }
  
  .remove-part-btn:hover {
    background: rgba(239, 68, 68, 0.2);
  }
  
  .remove-part-btn i {
    width: 18px;
    height: 18px;
  }
  
  .add-part-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.875rem;
    background: transparent;
    border: 2px dashed var(--admin-border);
    border-radius: 12px;
    color: var(--admin-text-muted);
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .add-part-btn:hover {
    border-color: #0ea5e9;
    color: #0ea5e9;
    background: rgba(14, 165, 233, 0.05);
  }
  
  .add-part-btn i {
    width: 18px;
    height: 18px;
  }
  
  /* Form Actions */
  .form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    padding: 1.5rem;
    background: var(--admin-bg-tertiary);
    border-top: 1px solid var(--admin-border);
    border-radius: 0 0 16px 16px;
  }
  
  @media (max-width: 768px) {
    .form-row {
      grid-template-columns: 1fr;
    }
    
    .form-row.three-cols {
      grid-template-columns: 1fr;
    }
    
    .priority-options {
      grid-template-columns: 1fr;
    }
    
    .part-row {
      grid-template-columns: 1fr;
      gap: 0.75rem;
    }
  }
</style>
</head>
<body class="module-aviation">
  <div class="admin-wrapper">
    <%- include('partials/sidebar', { activePage: 'aog', currentModule: 'aviation' }) %>
    
    <main class="admin-main">
      <%- include('partials/topbar', { pageTitle: 'Create AOG Case', currentModule: 'aviation' }) %>
      
      <div class="admin-content">
        <!-- Breadcrumb -->
        <div style="margin-bottom: 1.5rem;">
          <a href="/admin/aog" style="color: var(--admin-text-muted); text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
            <i data-lucide="arrow-left" style="width: 16px; height: 16px;"></i>
            Back to AOG Cases
          </a>
        </div>

        <!-- Page Header -->
        <div class="page-header" style="margin-bottom: 2rem;">
          <div>
            <h2 style="margin: 0 0 0.25rem 0;">Create New AOG Case</h2>
            <p style="color: var(--admin-text-muted); margin: 0; font-size: 0.9rem;">Submit a critical aircraft-on-ground parts request</p>
          </div>
        </div>

        <form id="createAOGForm">
          <div class="form-container">
            <!-- Priority Selection -->
            <div class="form-card">
              <div class="form-card-header">
                <h3><i data-lucide="alert-triangle"></i> Case Priority</h3>
              </div>
              <div class="form-card-body">
                <div class="priority-options">
                  <div class="priority-option critical">
                    <input type="radio" name="priority" id="priority-critical" value="critical" checked>
                    <label for="priority-critical">
                      <div class="priority-icon">
                        <i data-lucide="alert-circle"></i>
                      </div>
                      <span class="priority-name">Critical</span>
                      <span class="priority-desc">Immediate action required</span>
                    </label>
                  </div>
                  <div class="priority-option high">
                    <input type="radio" name="priority" id="priority-high" value="high">
                    <label for="priority-high">
                      <div class="priority-icon">
                        <i data-lucide="alert-triangle"></i>
                      </div>
                      <span class="priority-name">High</span>
                      <span class="priority-desc">Within 24 hours</span>
                    </label>
                  </div>
                  <div class="priority-option medium">
                    <input type="radio" name="priority" id="priority-medium" value="medium">
                    <label for="priority-medium">
                      <div class="priority-icon">
                        <i data-lucide="clock"></i>
                      </div>
                      <span class="priority-name">Medium</span>
                      <span class="priority-desc">Within 48 hours</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Aircraft Information -->
            <div class="form-card">
              <div class="form-card-header">
                <h3><i data-lucide="plane"></i> Aircraft Information</h3>
              </div>
              <div class="form-card-body">
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Aircraft Type <span class="required">*</span></label>
                    <input type="text" class="form-input" name="aircraftType" placeholder="e.g., Boeing 737-800" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Registration / Tail Number <span class="required">*</span></label>
                    <input type="text" class="form-input" name="registration" placeholder="e.g., N12345" required>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Airline / Operator <span class="required">*</span></label>
                    <input type="text" class="form-input" name="customer" placeholder="e.g., Delta Airlines" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Aircraft Location / Station <span class="required">*</span></label>
                    <input type="text" class="form-input" name="station" placeholder="e.g., JFK Airport, New York" required>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">SLA Deadline <span class="required">*</span></label>
                    <input type="datetime-local" class="form-input" name="deadline" required>
                    <span class="form-hint">When must the parts arrive by?</span>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Contact Phone</label>
                    <input type="tel" class="form-input" name="contactPhone" placeholder="+1 (555) 123-4567">
                  </div>
                </div>
              </div>
            </div>

            <!-- Required Parts -->
            <div class="form-card">
              <div class="form-card-header">
                <h3><i data-lucide="package"></i> Required Parts</h3>
              </div>
              <div class="form-card-body">
                <div class="parts-section" id="partsContainer">
                  <div class="part-row">
                    <div class="form-group">
                      <label class="form-label">Part Number / Description <span class="required">*</span></label>
                      <input type="text" class="form-input" name="partNumber[]" placeholder="e.g., PN-789456 - Main Landing Gear Actuator" required>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Condition</label>
                      <select class="form-select" name="condition[]">
                        <option value="new">New</option>
                        <option value="overhauled">Overhauled</option>
                        <option value="serviceable">Serviceable</option>
                        <option value="as_removed">As Removed</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label class="form-label">Qty</label>
                      <input type="number" class="form-input" name="quantity[]" min="1" value="1" required>
                    </div>
                    <button type="button" class="remove-part-btn" onclick="removePart(this)" style="opacity: 0.3;" disabled>
                      <i data-lucide="trash-2"></i>
                    </button>
                  </div>
                </div>
                <button type="button" class="add-part-btn" onclick="addPart()">
                  <i data-lucide="plus"></i>
                  Add Another Part
                </button>
              </div>
            </div>

            <!-- Additional Details -->
            <div class="form-card">
              <div class="form-card-header">
                <h3><i data-lucide="file-text"></i> Additional Details</h3>
              </div>
              <div class="form-card-body">
                <div class="form-group">
                  <label class="form-label">Problem Description</label>
                  <textarea class="form-textarea" name="description" placeholder="Describe the issue requiring these parts..."></textarea>
                </div>
                <div class="form-row" style="margin-top: 1.5rem;">
                  <div class="form-group">
                    <label class="form-label">Reference / PO Number</label>
                    <input type="text" class="form-input" name="reference" placeholder="e.g., PO-2025-001">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Internal Notes</label>
                    <input type="text" class="form-input" name="internalNotes" placeholder="Notes for internal use only">
                  </div>
                </div>
              </div>
              <div class="form-actions">
                <a href="/admin/aog" class="admin-btn admin-btn-secondary">
                  Cancel
                </a>
                <button type="button" class="admin-btn" style="background: rgba(14, 165, 233, 0.12); color: #0ea5e9;" onclick="saveDraft()">
                  <i data-lucide="save"></i>
                  Save Draft
                </button>
                <button type="submit" class="admin-btn admin-btn-primary">
                  <i data-lucide="send"></i>
                  Create AOG Case
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </main>
  </div>

  <script>
    // Set default deadline to 24 hours from now
    var deadline = new Date();
    deadline.setHours(deadline.getHours() + 24);
    var deadlineInput = document.querySelector('input[name="deadline"]');
    deadlineInput.value = deadline.toISOString().slice(0, 16);

    // Add part row
    function addPart() {
      var container = document.getElementById('partsContainer');
      var partRow = document.createElement('div');
      partRow.className = 'part-row';
      partRow.innerHTML = `
        <div class="form-group">
          <label class="form-label">Part Number / Description <span class="required">*</span></label>
          <input type="text" class="form-input" name="partNumber[]" placeholder="e.g., PN-789456 - Main Landing Gear Actuator" required>
        </div>
        <div class="form-group">
          <label class="form-label">Condition</label>
          <select class="form-select" name="condition[]">
            <option value="new">New</option>
            <option value="overhauled">Overhauled</option>
            <option value="serviceable">Serviceable</option>
            <option value="as_removed">As Removed</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Qty</label>
          <input type="number" class="form-input" name="quantity[]" min="1" value="1" required>
        </div>
        <button type="button" class="remove-part-btn" onclick="removePart(this)">
          <i data-lucide="trash-2"></i>
        </button>
      `;
      container.appendChild(partRow);
      
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
      
      // Enable first row's remove button
      var rows = container.querySelectorAll('.part-row');
      rows.forEach(function(row) {
        var btn = row.querySelector('.remove-part-btn');
        if (rows.length > 1) {
          btn.style.opacity = '1';
          btn.disabled = false;
        }
      });
    }
    
    // Remove part row
    function removePart(btn) {
      var container = document.getElementById('partsContainer');
      var rows = container.querySelectorAll('.part-row');
      
      if (rows.length > 1) {
        btn.closest('.part-row').remove();
        
        rows = container.querySelectorAll('.part-row');
        if (rows.length === 1) {
          var firstBtn = rows[0].querySelector('.remove-part-btn');
          firstBtn.style.opacity = '0.3';
          firstBtn.disabled = true;
        }
      }
    }
    
    // Save draft
    function saveDraft() {
      alert('Draft saved successfully! (UI Demo)');
    }
    
    // Form submission
    document.getElementById('createAOGForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Generate case ID
      var caseId = 'AOG-2025-' + String(Math.floor(Math.random() * 900) + 100);
      
      alert('AOG Case ' + caseId + ' created successfully!');
      window.location.href = '/admin/aog/' + caseId;
    });
  </script>

<%- include('partials/footer') %>
