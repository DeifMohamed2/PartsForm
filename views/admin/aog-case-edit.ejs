<%- include('partials/header') %>
<link rel="stylesheet" href="/css/adminCSS/admin-dashboard.css">
<link rel="stylesheet" href="/css/adminCSS/admin-aog.css">
<style>
  /* Same form styles as create page */
  .form-container { width: 100%; }
  .form-card { background: var(--admin-bg-secondary); border: 1px solid var(--admin-border); border-radius: 16px; overflow: hidden; margin-bottom: 1.5rem; }
  .form-card-header { padding: 1rem 1.5rem; border-bottom: 1px solid var(--admin-border); background: var(--admin-bg-tertiary); }
  .form-card-header h3 { font-size: 1rem; font-weight: 600; color: var(--admin-text-primary); margin: 0; display: flex; align-items: center; gap: 0.5rem; }
  .form-card-header h3 i { width: 18px; height: 18px; color: #0ea5e9; }
  .form-card-body { padding: 1.5rem; }
  .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; margin-bottom: 1.5rem; }
  .form-row:last-child { margin-bottom: 0; }
  .form-row.single { grid-template-columns: 1fr; }
  .form-group { display: flex; flex-direction: column; gap: 0.5rem; }
  .form-label { font-size: 0.85rem; font-weight: 600; color: var(--admin-text-primary); display: flex; align-items: center; gap: 0.25rem; }
  .form-label .required { color: #ef4444; }
  .form-input, .form-select, .form-textarea { padding: 0.75rem 1rem; background: var(--admin-bg-primary); border: 1px solid var(--admin-border); border-radius: 10px; color: var(--admin-text-primary); font-size: 0.9rem; transition: all 0.2s ease; }
  .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: #0ea5e9; box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1); }
  .form-textarea { min-height: 100px; resize: vertical; }
  .form-select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 1rem center; padding-right: 2.5rem; }
  .form-hint { font-size: 0.75rem; color: var(--admin-text-muted); }
  .priority-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
  .priority-option { position: relative; }
  .priority-option input { position: absolute; opacity: 0; pointer-events: none; }
  .priority-option label { display: flex; flex-direction: column; align-items: center; padding: 1.25rem; background: var(--admin-bg-primary); border: 2px solid var(--admin-border); border-radius: 12px; cursor: pointer; transition: all 0.2s ease; }
  .priority-option label:hover { border-color: var(--admin-text-muted); }
  .priority-option input:checked + label { border-color: #0ea5e9; background: rgba(14, 165, 233, 0.05); }
  .priority-option.critical input:checked + label { border-color: #ef4444; background: rgba(239, 68, 68, 0.05); }
  .priority-option.high input:checked + label { border-color: #f59e0b; background: rgba(245, 158, 11, 0.05); }
  .priority-option.medium input:checked + label { border-color: #3b82f6; background: rgba(59, 130, 246, 0.05); }
  .priority-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 0.75rem; }
  .priority-icon i { width: 20px; height: 20px; }
  .priority-option.critical .priority-icon { background: rgba(239, 68, 68, 0.12); color: #ef4444; }
  .priority-option.high .priority-icon { background: rgba(245, 158, 11, 0.12); color: #f59e0b; }
  .priority-option.medium .priority-icon { background: rgba(59, 130, 246, 0.12); color: #3b82f6; }
  .priority-name { font-weight: 600; color: var(--admin-text-primary); font-size: 0.9rem; margin-bottom: 0.25rem; }
  .priority-desc { font-size: 0.75rem; color: var(--admin-text-muted); text-align: center; }
  .parts-section { margin-top: 1rem; }
  .part-row { display: grid; grid-template-columns: 2fr 1fr 100px auto; gap: 1rem; align-items: end; padding: 1rem; background: var(--admin-bg-tertiary); border-radius: 12px; margin-bottom: 0.75rem; }
  .part-row .form-group { margin-bottom: 0; }
  .remove-part-btn { width: 40px; height: 40px; border: none; background: rgba(239, 68, 68, 0.1); color: #ef4444; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; }
  .remove-part-btn:hover { background: rgba(239, 68, 68, 0.2); }
  .remove-part-btn i { width: 18px; height: 18px; }
  .add-part-btn { display: flex; align-items: center; justify-content: center; gap: 0.5rem; width: 100%; padding: 0.875rem; background: transparent; border: 2px dashed var(--admin-border); border-radius: 12px; color: var(--admin-text-muted); font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: all 0.2s ease; }
  .add-part-btn:hover { border-color: #0ea5e9; color: #0ea5e9; background: rgba(14, 165, 233, 0.05); }
  .add-part-btn i { width: 18px; height: 18px; }
  .form-actions { display: flex; justify-content: space-between; gap: 1rem; padding: 1.5rem; background: var(--admin-bg-tertiary); border-top: 1px solid var(--admin-border); border-radius: 0 0 16px 16px; }
  .form-actions-left { display: flex; gap: 0.75rem; }
  .form-actions-right { display: flex; gap: 0.75rem; }
  .danger-btn { background: rgba(239, 68, 68, 0.1); color: #ef4444; border: none; }
  .danger-btn:hover { background: rgba(239, 68, 68, 0.2); }
  @media (max-width: 768px) { .form-row { grid-template-columns: 1fr; } .priority-options { grid-template-columns: 1fr; } .part-row { grid-template-columns: 1fr; gap: 0.75rem; } }
</style>
</head>
<body class="module-aviation">
  <div class="admin-wrapper">
    <%- include('partials/sidebar', { activePage: 'aog', currentModule: 'aviation' }) %>
    
    <main class="admin-main">
      <%- include('partials/topbar', { pageTitle: 'Edit AOG Case', currentModule: 'aviation' }) %>
      
      <div class="admin-content">
        <!-- Breadcrumb -->
        <div style="margin-bottom: 1.5rem;">
          <a href="/admin/aog" style="color: var(--admin-text-muted); text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
            <i data-lucide="arrow-left" style="width: 16px; height: 16px;"></i>
            Back to AOG Cases
          </a>
        </div>

        <!-- Page Header -->
        <div class="page-header" style="margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: flex-start;">
          <div>
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
              <h2 style="margin: 0;">Edit <%= aogCase.id %></h2>
              <span class="priority-badge <%= aogCase.priority %>">
                <i data-lucide="<%= aogCase.priority === 'critical' ? 'alert-circle' : 'alert-triangle' %>"></i>
                <%= aogCase.priority.toUpperCase() %>
              </span>
            </div>
            <p style="color: var(--admin-text-muted); margin: 0; font-size: 0.9rem;"><%= aogCase.aircraft %> â€¢ <%= aogCase.registration %></p>
          </div>
          <a href="/admin/aog/<%= aogCase.id %>" class="admin-btn admin-btn-secondary">
            <i data-lucide="eye"></i>
            View Details
          </a>
        </div>

        <form id="editAOGForm">
          <div class="form-container">
            <!-- Status & Priority -->
            <div class="form-card">
              <div class="form-card-header">
                <h3><i data-lucide="settings"></i> Case Status</h3>
              </div>
              <div class="form-card-body">
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Current Status <span class="required">*</span></label>
                    <select class="form-select" name="status" required>
                      <option value="sourcing" <%= aogCase.status === 'sourcing' ? 'selected' : '' %>>Sourcing</option>
                      <option value="quotes_received" <%= aogCase.status === 'quotes_received' ? 'selected' : '' %>>Quotes Received</option>
                      <option value="in_progress" <%= aogCase.status === 'in_progress' ? 'selected' : '' %>>In Progress</option>
                      <option value="shipped" <%= aogCase.status === 'shipped' ? 'selected' : '' %>>Shipped</option>
                      <option value="delivered" <%= aogCase.status === 'delivered' ? 'selected' : '' %>>Delivered</option>
                      <option value="closed" <%= aogCase.status === 'closed' ? 'selected' : '' %>>Closed</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">ETA</label>
                    <input type="text" class="form-input" name="eta" value="<%= aogCase.eta %>" placeholder="e.g., 4 hours">
                  </div>
                </div>
                <div style="margin-top: 1rem;">
                  <label class="form-label" style="margin-bottom: 1rem;">Priority Level</label>
                  <div class="priority-options">
                    <div class="priority-option critical">
                      <input type="radio" name="priority" id="priority-critical" value="critical" <%= aogCase.priority === 'critical' ? 'checked' : '' %>>
                      <label for="priority-critical">
                        <div class="priority-icon"><i data-lucide="alert-circle"></i></div>
                        <span class="priority-name">Critical</span>
                        <span class="priority-desc">Immediate action</span>
                      </label>
                    </div>
                    <div class="priority-option high">
                      <input type="radio" name="priority" id="priority-high" value="high" <%= aogCase.priority === 'high' ? 'checked' : '' %>>
                      <label for="priority-high">
                        <div class="priority-icon"><i data-lucide="alert-triangle"></i></div>
                        <span class="priority-name">High</span>
                        <span class="priority-desc">Within 24 hours</span>
                      </label>
                    </div>
                    <div class="priority-option medium">
                      <input type="radio" name="priority" id="priority-medium" value="medium" <%= aogCase.priority === 'medium' ? 'checked' : '' %>>
                      <label for="priority-medium">
                        <div class="priority-icon"><i data-lucide="clock"></i></div>
                        <span class="priority-name">Medium</span>
                        <span class="priority-desc">Within 48 hours</span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Aircraft Information -->
            <div class="form-card">
              <div class="form-card-header">
                <h3><i data-lucide="plane"></i> Aircraft Information</h3>
              </div>
              <div class="form-card-body">
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Aircraft Type <span class="required">*</span></label>
                    <input type="text" class="form-input" name="aircraftType" value="<%= aogCase.aircraft %>" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Registration / Tail Number <span class="required">*</span></label>
                    <input type="text" class="form-input" name="registration" value="<%= aogCase.registration %>" required>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Airline / Operator <span class="required">*</span></label>
                    <input type="text" class="form-input" name="customer" value="<%= aogCase.customer %>" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Contact Phone</label>
                    <input type="tel" class="form-input" name="contactPhone" value="+1 (555) 123-4567">
                  </div>
                </div>
              </div>
            </div>

            <!-- Part Information -->
            <div class="form-card">
              <div class="form-card-header">
                <h3><i data-lucide="package"></i> Part Information</h3>
              </div>
              <div class="form-card-body">
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label">Part Number <span class="required">*</span></label>
                    <input type="text" class="form-input" name="partNumber" value="<%= aogCase.partNumber %>" required>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" class="form-input" name="description" value="<%= aogCase.description %>">
                  </div>
                </div>
              </div>
            </div>

            <!-- Notes -->
            <div class="form-card">
              <div class="form-card-header">
                <h3><i data-lucide="file-text"></i> Notes & Updates</h3>
              </div>
              <div class="form-card-body">
                <div class="form-group">
                  <label class="form-label">Status Update Notes</label>
                  <textarea class="form-textarea" name="notes" placeholder="Add notes about recent updates or status changes..."></textarea>
                </div>
              </div>
              <div class="form-actions">
                <div class="form-actions-left">
                  <button type="button" class="admin-btn danger-btn" onclick="deleteCase()">
                    <i data-lucide="trash-2"></i>
                    Delete Case
                  </button>
                </div>
                <div class="form-actions-right">
                  <a href="/admin/aog/<%= aogCase.id %>" class="admin-btn admin-btn-secondary">Cancel</a>
                  <button type="submit" class="admin-btn admin-btn-primary">
                    <i data-lucide="check"></i>
                    Save Changes
                  </button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </main>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal-content" style="max-width: 420px;">
      <div class="modal-header">
        <div class="modal-icon" style="background: rgba(239, 68, 68, 0.12); color: #ef4444;">
          <i data-lucide="trash-2"></i>
        </div>
        <div>
          <h3>Delete AOG Case</h3>
          <p>This action cannot be undone</p>
        </div>
        <button class="modal-close" onclick="closeModal()">
          <i data-lucide="x"></i>
        </button>
      </div>
      <div class="modal-body">
        <p style="color: var(--admin-text-secondary);">Are you sure you want to delete case <strong><%= aogCase.id %></strong>? All associated data will be permanently removed.</p>
      </div>
      <div class="modal-footer">
        <button class="admin-btn admin-btn-secondary" onclick="closeModal()">Cancel</button>
        <button class="admin-btn" style="background: #ef4444; color: white;" onclick="confirmDelete()">
          <i data-lucide="trash-2"></i>
          Delete Case
        </button>
      </div>
    </div>
  </div>

  <script>
    function deleteCase() {
      document.getElementById('deleteModal').classList.add('active');
      if (typeof lucide !== 'undefined') lucide.createIcons();
    }
    
    function closeModal() {
      document.getElementById('deleteModal').classList.remove('active');
    }
    
    function confirmDelete() {
      alert('Case deleted successfully! (UI Demo)');
      window.location.href = '/admin/aog';
    }
    
    document.getElementById('deleteModal').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });
    
    document.getElementById('editAOGForm').addEventListener('submit', function(e) {
      e.preventDefault();
      alert('Changes saved successfully!');
      window.location.href = '/admin/aog/<%= aogCase.id %>';
    });
  </script>

<%- include('partials/footer') %>
