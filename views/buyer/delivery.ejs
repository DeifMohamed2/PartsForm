<%- include('partials/header') %>
<link rel="stylesheet" href="/css/buyerCSS/buyer-main.css">
<link rel="stylesheet" href="/css/buyerCSS/delivery.css">

<%- include('partials/navbar') %>

<!-- ====================================
     DELIVERY PAGE - PROFESSIONAL DESIGN
     ==================================== -->
<div class="delivery-page">
  <!-- Header Bar -->
  <div class="delivery-header-bar">
    <div class="container">
      <div class="delivery-header-content">
        <div class="delivery-header-left">
          <h1 class="delivery-header-title">
            <i data-lucide="truck"></i>
            <span><%= t('delivery.title') %></span>
          </h1>
          <p class="delivery-header-subtitle"><%= t('delivery.subtitle') %></p>
        </div>
        <div class="delivery-header-right">
          <button class="btn-add-address" id="btn-add-address">
            <i data-lucide="plus"></i>
            <span><%= t('delivery.addNewAddress') %></span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delivery Content -->
  <div class="delivery-content">
    <div class="container">
      <!-- Addresses Grid -->
      <div class="addresses-section">
        <div class="section-header">
          <h2 class="section-title">
            <i data-lucide="map-pin"></i>
            <span><%= t('delivery.savedAddresses') %></span>
          </h2>
          <p class="section-subtitle"><%= t('delivery.manageLocations') %></p>
        </div>

        <div class="addresses-grid" id="addresses-grid">
          <!-- Addresses will be populated by JavaScript -->
        </div>

        <!-- Empty State -->
        <div class="addresses-empty" id="addresses-empty" style="display: none;">
          <div class="empty-icon">
            <i data-lucide="map-pin-off"></i>
          </div>
          <h3 class="empty-title"><%= t('delivery.noAddresses') %></h3>
          <p class="empty-text"><%= t('delivery.noAddressesDesc') %></p>
          <button class="btn-empty-action" onclick="document.getElementById('btn-add-address').click()">
            <i data-lucide="plus"></i>
            <span><%= t('delivery.addAddress') %></span>
          </button>
        </div>
      </div>

      <!-- Order Tracking Section -->
      <div class="tracking-section">
        <div class="section-header">
          <h2 class="section-title">
            <i data-lucide="package-search"></i>
            <span><%= t('delivery.trackOrder') %></span>
          </h2>
          <p class="section-subtitle"><%= t('delivery.trackOrderDesc') %></p>
        </div>

        <div class="tracking-card">
          <div class="tracking-input-wrapper">
            <i data-lucide="search" class="tracking-icon"></i>
            <input 
              type="text" 
              class="tracking-input" 
              id="tracking-input" 
              placeholder="<%= t('delivery.trackingPlaceholder') %>"
            >
            <button class="btn-track" id="btn-track">
              <span><%= t('delivery.track') %></span>
              <i data-lucide="arrow-right"></i>
            </button>
          </div>
          <div class="tracking-quick-links">
            <a href="/buyer/orders" class="quick-link">
              <i data-lucide="package"></i>
              <span><%= t('delivery.viewAllOrders') %></span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add/Edit Address Modal -->
<div class="address-modal" id="address-modal">
  <div class="address-modal-backdrop"></div>
  <div class="address-modal-container">
    <button class="address-modal-close" id="modal-close">
      <i data-lucide="x"></i>
    </button>
    
    <div class="address-modal-content">
      <div class="modal-header">
        <div class="modal-icon">
          <i data-lucide="map-pin"></i>
        </div>
        <h2 class="modal-title" id="modal-title"><%= t('delivery.addNewAddress') %></h2>
        <p class="modal-subtitle"><%= t('delivery.fillDetails') %></p>
      </div>

      <form class="address-form" id="address-form">
        <input type="hidden" id="address-id">
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="address-name"><%= t('delivery.form.label') %> *</label>
            <input 
              type="text" 
              class="form-input" 
              id="address-name" 
              placeholder="<%= t('delivery.form.labelPlaceholder') %>"
              required
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="address-fullname"><%= t('delivery.form.fullName') %> *</label>
            <input 
              type="text" 
              class="form-input" 
              id="address-fullname" 
              placeholder="<%= t('delivery.form.fullNamePlaceholder') %>"
              required
            >
          </div>
          <div class="form-group">
            <label class="form-label" for="address-phone"><%= t('delivery.form.phone') %> *</label>
            <input 
              type="tel" 
              class="form-input" 
              id="address-phone" 
              placeholder="+971 XX XXX XXXX"
              required
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label class="form-label" for="address-street"><%= t('delivery.form.street') %> *</label>
            <input 
              type="text" 
              class="form-input" 
              id="address-street" 
              placeholder="<%= t('delivery.form.streetPlaceholder') %>"
              required
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="address-city"><%= t('delivery.form.city') %> *</label>
            <input 
              type="text" 
              class="form-input" 
              id="address-city" 
              placeholder="<%= t('delivery.form.cityPlaceholder') %>"
              required
            >
          </div>
          <div class="form-group">
            <label class="form-label" for="address-state"><%= t('delivery.form.state') %> *</label>
            <input 
              type="text" 
              class="form-input" 
              id="address-state" 
              placeholder="<%= t('delivery.form.statePlaceholder') %>"
              required
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="address-country"><%= t('delivery.form.country') %> *</label>
            <input 
              type="text" 
              class="form-input" 
              id="address-country" 
              placeholder="<%= t('delivery.form.countryPlaceholder') %>"
              required
            >
          </div>
          <div class="form-group">
            <label class="form-label" for="address-postal"><%= t('delivery.form.postalCode') %></label>
            <input 
              type="text" 
              class="form-input" 
              id="address-postal" 
              placeholder="<%= t('delivery.form.optional') %>"
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label class="form-label" for="address-notes"><%= t('delivery.form.notes') %></label>
            <textarea 
              class="form-textarea" 
              id="address-notes" 
              rows="3"
              placeholder="<%= t('delivery.form.notesPlaceholder') %>"
            ></textarea>
          </div>
        </div>

        <div class="form-row">
          <label class="checkbox-label">
            <input type="checkbox" id="address-default">
            <span><%= t('delivery.form.setDefault') %></span>
          </label>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" id="btn-cancel">
            <i data-lucide="x"></i>
            <span><%= t('common.cancel') %></span>
          </button>
          <button type="submit" class="btn-save">
            <i data-lucide="check"></i>
            <span><%= t('delivery.saveAddress') %></span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="confirm-modal" id="confirm-modal">
  <div class="confirm-modal-backdrop"></div>
  <div class="confirm-modal-container">
    <div class="confirm-modal-content">
      <div class="confirm-icon">
        <i data-lucide="alert-triangle"></i>
      </div>
      <h2 class="confirm-title" id="confirm-title"><%= t('delivery.deleteAddress') %></h2>
      <p class="confirm-message" id="confirm-message"><%= t('delivery.deleteAddressConfirm') %></p>
      
      <div class="confirm-actions">
        <button class="btn-confirm-cancel" id="btn-confirm-cancel">
          <i data-lucide="x"></i>
          <span><%= t('common.cancel') %></span>
        </button>
        <button class="btn-confirm-delete" id="btn-confirm-delete">
          <i data-lucide="trash-2"></i>
          <span><%= t('common.delete') %></span>
        </button>
      </div>
    </div>
  </div>
</div>

<%- include('partials/quick-search') %>
<%- include('partials/footer') %>

<script src="/js/main.js"></script>
<script src="/js/quick-search.js"></script>
<script src="/js/cart.js"></script>
<script src="/js/cart-badge-updater.js"></script>
<script src="/js/delivery.js"></script>
<script>
  lucide.createIcons();
  window.addEventListener('load', () => lucide.createIcons());
  
  // Force navbar to always stay white on delivery page
  document.addEventListener('DOMContentLoaded', () => {
    const navbar = document.getElementById('navbar');
    if (navbar) {
      navbar.classList.add('scrolled');
      // Prevent other scripts from removing the scrolled class
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            if (!navbar.classList.contains('scrolled')) {
              navbar.classList.add('scrolled');
            }
          }
        });
      });
      observer.observe(navbar, { attributes: true, attributeFilter: ['class'] });
      // Also ensure on scroll
      const ensureScrolled = () => navbar.classList.add('scrolled');
      window.addEventListener('scroll', ensureScrolled, { passive: true });
    }
  });
</script>