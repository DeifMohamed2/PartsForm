<%- include('partials/header') %>
<link rel="stylesheet" href="/css/buyerCSS/buyer-main.css">
<link rel="stylesheet" href="/css/buyerCSS/delivery.css">

<%- include('partials/navbar') %>

<!-- ====================================
     DELIVERY PAGE - PROFESSIONAL DESIGN
     ==================================== -->
<div class="delivery-page">
  <!-- Header Bar -->
  <div class="delivery-header-bar">
    <div class="container">
      <div class="delivery-header-content">
        <div class="delivery-header-left">
          <h1 class="delivery-header-title">
            <i data-lucide="truck"></i>
            <span>Delivery Addresses</span>
          </h1>
          <p class="delivery-header-subtitle">Manage your delivery addresses and track shipments</p>
        </div>
        <div class="delivery-header-right">
          <button class="btn-add-address" id="btn-add-address">
            <i data-lucide="plus"></i>
            <span>Add New Address</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delivery Content -->
  <div class="delivery-content">
    <div class="container">
      <!-- Addresses Grid -->
      <div class="addresses-section">
        <div class="section-header">
          <h2 class="section-title">
            <i data-lucide="map-pin"></i>
            <span>Saved Addresses</span>
          </h2>
          <p class="section-subtitle">Manage your delivery locations</p>
        </div>

        <div class="addresses-grid" id="addresses-grid">
          <!-- Addresses will be populated by JavaScript -->
        </div>

        <!-- Empty State -->
        <div class="addresses-empty" id="addresses-empty" style="display: none;">
          <div class="empty-icon">
            <i data-lucide="map-pin-off"></i>
          </div>
          <h3 class="empty-title">No Addresses Yet</h3>
          <p class="empty-text">Add your first delivery address to get started</p>
          <button class="btn-empty-action" onclick="document.getElementById('btn-add-address').click()">
            <i data-lucide="plus"></i>
            <span>Add Address</span>
          </button>
        </div>
      </div>

      <!-- Order Tracking Section -->
      <div class="tracking-section">
        <div class="section-header">
          <h2 class="section-title">
            <i data-lucide="package-search"></i>
            <span>Track Your Order</span>
          </h2>
          <p class="section-subtitle">Enter your order number to track shipment</p>
        </div>

        <div class="tracking-card">
          <div class="tracking-input-wrapper">
            <i data-lucide="search" class="tracking-icon"></i>
            <input 
              type="text" 
              class="tracking-input" 
              id="tracking-input" 
              placeholder="Enter order number (e.g., ORD-123456)"
            >
            <button class="btn-track" id="btn-track">
              <span>Track</span>
              <i data-lucide="arrow-right"></i>
            </button>
          </div>
          <div class="tracking-quick-links">
            <a href="/buyer/orders" class="quick-link">
              <i data-lucide="package"></i>
              <span>View All Orders</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add/Edit Address Modal -->
<div class="address-modal" id="address-modal">
  <div class="address-modal-backdrop"></div>
  <div class="address-modal-container">
    <button class="address-modal-close" id="modal-close">
      <i data-lucide="x"></i>
    </button>
    
    <div class="address-modal-content">
      <div class="modal-header">
        <div class="modal-icon">
          <i data-lucide="map-pin"></i>
        </div>
        <h2 class="modal-title" id="modal-title">Add New Address</h2>
        <p class="modal-subtitle">Fill in the details below</p>
      </div>

      <form class="address-form" id="address-form">
        <input type="hidden" id="address-id">
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="address-name">Address Label *</label>
            <input 
              type="text" 
              class="form-input" 
              id="address-name" 
              placeholder="e.g., Home, Office, Warehouse"
              required
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="address-fullname">Full Name *</label>
            <input 
              type="text" 
              class="form-input" 
              id="address-fullname" 
              placeholder="Recipient's full name"
              required
            >
          </div>
          <div class="form-group">
            <label class="form-label" for="address-phone">Phone Number *</label>
            <input 
              type="tel" 
              class="form-input" 
              id="address-phone" 
              placeholder="+971 XX XXX XXXX"
              required
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label class="form-label" for="address-street">Street Address *</label>
            <input 
              type="text" 
              class="form-input" 
              id="address-street" 
              placeholder="Building number, street name"
              required
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="address-city">City *</label>
            <input 
              type="text" 
              class="form-input" 
              id="address-city" 
              placeholder="e.g., Dubai"
              required
            >
          </div>
          <div class="form-group">
            <label class="form-label" for="address-state">State/Emirate *</label>
            <input 
              type="text" 
              class="form-input" 
              id="address-state" 
              placeholder="e.g., Dubai"
              required
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="address-country">Country *</label>
            <input 
              type="text" 
              class="form-input" 
              id="address-country" 
              placeholder="e.g., United Arab Emirates"
              required
            >
          </div>
          <div class="form-group">
            <label class="form-label" for="address-postal">Postal Code</label>
            <input 
              type="text" 
              class="form-input" 
              id="address-postal" 
              placeholder="Optional"
            >
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label class="form-label" for="address-notes">Additional Notes</label>
            <textarea 
              class="form-textarea" 
              id="address-notes" 
              rows="3"
              placeholder="Landmarks, special instructions, etc."
            ></textarea>
          </div>
        </div>

        <div class="form-row">
          <label class="checkbox-label">
            <input type="checkbox" id="address-default">
            <span>Set as default address</span>
          </label>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" id="btn-cancel">
            <i data-lucide="x"></i>
            <span>Cancel</span>
          </button>
          <button type="submit" class="btn-save">
            <i data-lucide="check"></i>
            <span>Save Address</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="confirm-modal" id="confirm-modal">
  <div class="confirm-modal-backdrop"></div>
  <div class="confirm-modal-container">
    <div class="confirm-modal-content">
      <div class="confirm-icon">
        <i data-lucide="alert-triangle"></i>
      </div>
      <h2 class="confirm-title" id="confirm-title">Delete Address?</h2>
      <p class="confirm-message" id="confirm-message">Are you sure you want to delete this address?</p>
      
      <div class="confirm-actions">
        <button class="btn-confirm-cancel" id="btn-confirm-cancel">
          <i data-lucide="x"></i>
          <span>Cancel</span>
        </button>
        <button class="btn-confirm-delete" id="btn-confirm-delete">
          <i data-lucide="trash-2"></i>
          <span>Delete</span>
        </button>
      </div>
    </div>
  </div>
</div>

<%- include('partials/quick-search') %>
<%- include('partials/footer') %>

<script src="/js/main.js"></script>
<script src="/js/quick-search.js"></script>
<script src="/js/cart.js"></script>
<script src="/js/cart-badge-updater.js"></script>
<script src="/js/delivery.js"></script>
<script>
  lucide.createIcons();
  window.addEventListener('load', () => lucide.createIcons());
  
  // Force navbar to always stay white on delivery page
  document.addEventListener('DOMContentLoaded', () => {
    const navbar = document.getElementById('navbar');
    if (navbar) {
      navbar.classList.add('scrolled');
      // Prevent other scripts from removing the scrolled class
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            if (!navbar.classList.contains('scrolled')) {
              navbar.classList.add('scrolled');
            }
          }
        });
      });
      observer.observe(navbar, { attributes: true, attributeFilter: ['class'] });
      // Also ensure on scroll
      const ensureScrolled = () => navbar.classList.add('scrolled');
      window.addEventListener('scroll', ensureScrolled, { passive: true });
    }
  });
</script>