<%- include('partials/header') %>
  <link rel="stylesheet" href="/css/buyerCSS/buyer-main.css">
  <link rel="stylesheet" href="/css/buyerCSS/orders.css">

  <%- include('partials/navbar') %>

    <!-- ====================================
     ORDERS PAGE - PROFESSIONAL DESIGN
     ==================================== -->
    <div class="orders-page">
      <!-- Header Bar -->
      <div class="orders-header-bar">
        <div class="container">
          <div class="orders-header-content">
            <div class="orders-header-left">
              <h1 class="orders-header-title">
                <i data-lucide="package"></i>
                <span><%= t('orders.title') %></span>
              </h1>
              <p class="orders-header-subtitle"><%= t('orders.subtitle') %></p>
            </div>
            <div class="orders-header-right">
              <div class="orders-stats">
                <div class="stat-card">
                  <div class="stat-card-icon pending">
                    <i data-lucide="clock"></i>
                  </div>
                  <div class="stat-card-content">
                    <span class="stat-card-value" id="stat-pending">0</span>
                    <span class="stat-card-label"><%= t('orders.stats.pending') %></span>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-card-icon processing">
                    <i data-lucide="loader"></i>
                  </div>
                  <div class="stat-card-content">
                    <span class="stat-card-value" id="stat-processing">0</span>
                    <span class="stat-card-label"><%= t('orders.stats.processing') %></span>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-card-icon completed">
                    <i data-lucide="check-circle"></i>
                  </div>
                  <div class="stat-card-content">
                    <span class="stat-card-value" id="stat-completed">0</span>
                    <span class="stat-card-label"><%= t('orders.stats.completed') %></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Orders Content -->
      <div class="orders-content">
        <div class="container">
          <!-- Filters -->
          <div class="orders-filters">
            <div class="filters-row">
              <div class="filter-group">
                <label class="filter-label" for="filter-status"><%= t('orders.filters.status') %></label>
                <select class="filter-select" id="filter-status">
                  <option value=""><%= t('orders.filters.allStatuses') %></option>
                  <option value="pending"><%= t('orders.filters.pending') %></option>
                  <option value="processing"><%= t('orders.filters.processing') %></option>
                  <option value="shipped"><%= t('orders.filters.shipped') %></option>
                  <option value="delivered"><%= t('orders.filters.delivered') %></option>
                  <option value="completed"><%= t('orders.filters.completed') %></option>
                  <option value="cancelled"><%= t('orders.filters.cancelled') %></option>
                </select>
              </div>
              <div class="filter-group">
                <label class="filter-label" for="filter-date-from"><%= t('orders.filters.dateFrom') %></label>
                <input type="date" class="filter-input" id="filter-date-from">
              </div>
              <div class="filter-group">
                <label class="filter-label" for="filter-date-to"><%= t('orders.filters.dateTo') %></label>
                <input type="date" class="filter-input" id="filter-date-to">
              </div>
              <div class="filter-group">
                <label class="filter-label" for="filter-search"><%= t('orders.filters.searchOrder') %></label>
                <input type="text" class="filter-input" id="filter-search" placeholder="<%= t('orders.filters.searchPlaceholder') %>">
              </div>
              <div class="filter-actions">
                <button class="btn-filter" id="btn-apply-filters">
                  <i data-lucide="filter"></i>
                  <span><%= t('orders.filters.applyFilters') %></span>
                </button>
                <button class="btn-reset" id="btn-reset-filters">
                  <i data-lucide="x"></i>
                  <span><%= t('orders.filters.reset') %></span>
                </button>
              </div>
            </div>
          </div>

          <!-- Orders Table -->
          <div class="orders-table-container" id="orders-table-container" style="display: none;">
            <table class="orders-table" id="orders-table">
              <thead>
                <tr>
                  <th class="sortable" data-sort="orderNumber">
                    <%= t('orders.table.orderNumber') %>
                  </th>
                  <th class="sortable" data-sort="date">
                    <%= t('orders.table.date') %>
                  </th>
                  <th><%= t('orders.table.status') %></th>
                  <th><%= t('orders.table.items') %></th>
                  <th class="sortable" data-sort="amount">
                    <%= t('orders.table.amount') %>
                  </th>
                  <th><%= t('orders.table.actions') %></th>
                </tr>
              </thead>
              <tbody id="orders-tbody">
                <!-- Orders will be populated by JavaScript -->
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <div class="orders-pagination" id="orders-pagination" style="display: none;">
            <button class="pagination-btn" id="btn-prev" disabled>
              <i data-lucide="chevron-left"></i>
              <span><%= t('orders.pagination.previous') %></span>
            </button>
            <span class="pagination-info" id="pagination-info"><%= t('orders.pagination.showing') %> <span id="pagination-from">0</span>-<span
                id="pagination-to">0</span> <%= t('orders.pagination.of') %> <span id="pagination-total">0</span></span>
            <button class="pagination-btn" id="btn-next" disabled>
              <span><%= t('orders.pagination.next') %></span>
              <i data-lucide="chevron-right"></i>
            </button>
          </div>

          <!-- Empty State -->
          <div class="orders-empty" id="orders-empty">
            <div class="orders-empty-icon">
              <i data-lucide="package-x"></i>
            </div>
            <h2 class="orders-empty-title"><%= t('orders.emptyState.title') %></h2>
            <p class="orders-empty-text">
              <%= t('orders.emptyState.text') %>
            </p>
            <div class="orders-empty-actions">
              <a href="/buyer/search-automotive" class="btn-empty-action primary">
                <i data-lucide="shopping-bag"></i>
                <span><%= t('orders.emptyState.startShopping') %></span>
              </a>
              <a href="/buyer" class="btn-empty-action secondary">
                <i data-lucide="arrow-left"></i>
                <span><%= t('orders.emptyState.backToMain') %></span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%- include('partials/quick-search') %>
      <%- include('partials/footer') %>

        <script src="/js/main.js"></script>
        <script src="/js/quick-search.js"></script>
        <script src="/js/cart.js"></script>
        <script src="/js/cart-badge-updater.js"></script>
        <script src="/js/orders.js"></script>
        <script>
          lucide.createIcons();
          window.addEventListener('load', () => lucide.createIcons());

          // Force navbar to always stay white on orders page
          document.addEventListener('DOMContentLoaded', () => {
            const navbar = document.getElementById('navbar');
            if (navbar) {
              navbar.classList.add('scrolled');
              // Prevent other scripts from removing the scrolled class
              const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                  if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                    if (!navbar.classList.contains('scrolled')) {
                      navbar.classList.add('scrolled');
                    }
                  }
                });
              });
              observer.observe(navbar, { attributes: true, attributeFilter: ['class'] });
              // Also ensure on scroll
              const ensureScrolled = () => navbar.classList.add('scrolled');
              window.addEventListener('scroll', ensureScrolled, { passive: true });
            }
          });

          // Order action functions
          window.viewOrder = function (orderNumber) {
            window.location.href = `/buyer/orders/${encodeURIComponent(orderNumber)}`;
          };

          window.trackOrder = function (orderNumber) {
            alert(`Tracking order ${orderNumber}\n\nThis will open the order tracking page.`);
            // window.location.href = `/buyer/orders/${orderNumber}/track`;
          };
        </script>